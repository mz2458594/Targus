<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Targus - Gesti√≥n de Pedidos</title>
    <link rel="stylesheet" th:href="@{/css/seguipedidos.css}">
    <link rel="icon" th:href="@{/images/logo.png}">
</head>

<body>
    <div th:insert="commerce/header.html"></div>
    <div class="container">

        <div style="margin-bottom: 1rem;">
            <button class="btn-back" onclick="window.history.back()">‚Üê Volver</button>
        </div>

        <div class="table-container">
            <h2>üì¶ Lista de Pedidos</h2>
            <table>
                <thead>
                    <tr>
                        <th>Pedido</th>
                        <th>Fecha</th>
                        <th>Estado</th>
                        <th>Direcci√≥n</th>
                        <th>Total</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="pedido : ${pedidos}">
                        <td th:text="${pedido.idPedido}">#PED-001</td>
                        <td th:text="${pedido.fechaPedido}">15/12/2024</td>
                        <td><span th:text="${pedido.estado}"
                            th:classappend="${pedido.estado} == 'COMPLETADO' ? ' status entregado' 
                            : (${pedido.estado} == 'PROCESANDO' ? 'status enviado' 
                            : ' status pendiente')"
                            >Entregado</span></td>
                        <td>Av. Principal 123, Ciudad</td>
                        <td class="total" th:text="${pedido.total}">$125.50</td>
                        <td>
                            <button 
                            class="btn"
                            th:attr="onclick=|openModal(${pedido.idPedido})|"
                            >Ver Detalle
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div id="orderModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">üõí Detalle del Pedido</h3>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="products-section">
                    <h4>Productos Comprados</h4>
                    <div id="productsList">

                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="total-section" style="width: 100%; text-align: center;">
                    <div class="total-label">Total del Pedido</div>
                    <div class="total-amount" id="orderTotal">$125.50</div>
                </div>
            </div>
        </div>
    </div>

    <script>

        function handleButtonClick(buttonElement) {
            const pedidoData = buttonElement.getAttribute('data-pedido')
            const pedido = JSON.parse(pedidoData)
            openModal(pedido)
        }


        function openModal(idPedido) {
            const order = ordersData.find(p => p.idPedido === idPedido)

            if (!order) return;

            // Actualizar t√≠tulo del modal
            document.getElementById('modalTitle').textContent = `üõí Pedido ${order.idPedido}`;

            // Actualizar total
            document.getElementById('orderTotal').textContent = order.total;

            // Actualizar lista de productos
            const productsList = document.getElementById('productsList');
            productsList.innerHTML = '';

            order.detallePedidos.forEach(detalle => {
                const productItem = document.createElement('div');
                productItem.className = 'product-item';
                productItem.innerHTML = `
                    <img src="${detalle.imagen}" alt="${detalle.nombreProducto}" class="product-image">
                    <div class="product-info">
                        <div class="product-name">${detalle.nombreProducto}</div>
                        <div class="product-details">Cantidad: ${detalle.cantidad} √ó $${detalle.precioVenta}</div>
                    </div>
                    <div class="product-total">${detalle.subtotal.toFixed(2)}</div>
                `;
                productsList.appendChild(productItem);
            });

            document.getElementById('orderModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            document.getElementById('orderModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Cerrar modal al hacer clic fuera de √©l
        window.onclick = function (event) {
            const modal = document.getElementById('orderModal');
            if (event.target === modal) {
                closeModal();
            }
        }

    </script>
    <div th:insert="commerce/footer.html"></div>
</body>
    <script th:inline="javascript">
        /*<!CDATA[*/
        const ordersData = [[${pedidos}]];
        /*]]>*/
    </script>
</html>